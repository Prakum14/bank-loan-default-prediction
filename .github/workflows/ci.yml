name: Python CI/CD Pipeline

on:
  # Triggers the workflow on push or pull request events to the main branch
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:
    runs-on: ubuntu-latest
    # Define environment variables used by the scripts
    env:
      PYTHONPATH: ${{ github.workspace }}/src # Allows importing from src/ if needed later

    steps:
    - name: Checkout repository and pull LFS files
      uses: actions/checkout@v4
      with:
        # CRITICAL ADDITION: Ensures the actual content of train.csv and test.csv is downloaded
        lfs: true

    - name: Set up Python 3.10
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    - name: Install dependencies (pandas, scikit-learn, joblib)
      run: |
        python -m pip install --upgrade pip
        # Install required ML libraries
        pip install pandas scikit-learn joblib

    - name: Prepare Data Directory
      # This step ensures the 'data' directory exists, which the Python script expects.
      run: |
        mkdir -p data
        # Assuming your CSVs are at the root, move them into the expected 'data/' folder
        # If your data is already correctly placed, you can skip these mv commands.
        if [ -f train.csv ]; then mv train.csv data/ ; fi
        if [ -f test.csv ]; then mv test.csv data/ ; fi

    - name: Run Model Training, Testing, and Saving
      # Execute the Python script that trains the model and saves artifacts/
      run: |
        python src/train_and_save.py

    # ------------------------------------------------------------------
    # NEW STEP: UPLOAD ARTIFACTS
    # This step is the key to seeing your final files on GitHub.
    # ------------------------------------------------------------------
    - name: Upload Training Artifacts
      uses: actions/upload-artifact@v4
      with:
        # The name of the downloadable artifact zip file
        name: loan-prediction-artifacts
        # The path to the directory containing all the files generated by the script
        path: artifacts/
        retention-days: 7 # How long the artifacts should be stored

    - name: Report Success
      run: echo "CI/CD Pipeline complete. Artifacts saved and available for download!"
        # Example: pytest tests/
        
    # --- Add further steps here for deployment, linting, etc. ---
